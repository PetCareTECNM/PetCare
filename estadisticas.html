<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pet Care - Estadísticas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #008080, #00a3a3);
      min-height: 100vh;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
      0% { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .header {
      background: #006666;
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      animation: slideDown 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideDown {
      0% { 
        transform: translateY(-100%); 
        opacity: 0; 
      }
      100% { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }

    .header h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      font-size: 28px;
    }

    .header .info {
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.9;
    }

    .container {
      display: flex;
      min-height: calc(100vh - 120px);
    }

    @keyframes slideInLeft {
      0% { 
        transform: translateX(-50px); 
        opacity: 0; 
      }
      100% { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }

    @keyframes slideInRight {
      0% { 
        transform: translateX(50px); 
        opacity: 0; 
      }
      100% { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }

    .sidebar {
      width: 250px;
      background: #004d4d;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .menu-section {
      margin-bottom: 30px;
    }

    .menu-title {
      color: white;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 20px;
      color: #b3d9d9;
      text-decoration: none;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 4px solid transparent;
      will-change: transform;
    }

    .menu-item:hover, .menu-item.active {
      background: #006666;
      color: white;
      border-left-color: #00e6e6;
    }

    .main-content {
      flex-grow: 1;
      padding: 30px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      margin: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      overflow: auto;
      animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
    }

    .page-title {
      color: #006666;
      margin-bottom: 20px;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .period-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      align-items: center;
    }

    .period-btn {
      padding: 10px 20px;
      border: 2px solid #008080;
      background: white;
      color: #008080;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .period-btn.active {
      background: #008080;
      color: white;
    }

    .period-btn:hover {
      background: #006666;
      color: white;
      border-color: #006666;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .stat-icon {
      font-size: 30px;
      color: #008080;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }

    .trend-up {
      color: #4CAF50;
    }

    .trend-down {
      color: #f44336;
    }

    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }

    .chart-container {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .chart-title {
      color: #006666;
      font-size: 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tables-section {
      margin-top: 30px;
    }

    .data-table {
      width: 100%;
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .data-table h3 {
      color: #006666;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table th,
    table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    table th {
      background: #f5f5f5;
      font-weight: bold;
      color: #333;
    }

    table tr:hover {
      background: #f9f9f9;
    }

    .ranking-position {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #008080;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .ranking-position.gold {
      background: #FFD700;
      color: #333;
    }

    .ranking-position.silver {
      background: #C0C0C0;
      color: #333;
    }

    .ranking-position.bronze {
      background: #CD7F32;
      color: white;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <i class="fas fa-paw"></i>
      Pet Care - Sistema Veterinario
    </h1>
    <div class="info">
      Calzada del Tecnológico S/N, Unidad Tomas Aquino
      <br>
      C.P. 22414, Tijuana, Baja California
      <br>
      664-623-4054
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-home"></i>
          Inicio
        </div>
        <a href="inicio.html" class="menu-item">
          <i class="fas fa-chart-line"></i>
          Dashboard
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-users"></i>
          Pacientes
        </div>
        <a href="registro.html" class="menu-item">
          <i class="fas fa-user-plus"></i>
          Registrar
        </a>
        <a href="buscar_mascota.html" class="menu-item">
          <i class="fas fa-search"></i>
          Buscar
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-stethoscope"></i>
          Consulta
        </div>
        <a href="consulta.html" class="menu-item">
          <i class="fas fa-user-plus"></i>
          Registrar
        </a>
        <a href="buscar_consulta.html" class="menu-item">
          <i class="fas fa-search"></i>
          Buscar
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-calendar-alt"></i>
          Gestión
        </div>
        <a href="calendario.html" class="menu-item">
          <i class="fas fa-calendar-check"></i>
          Calendario
        </a>
        <a href="recordatorios.html" class="menu-item">
          <i class="fas fa-bell"></i>
          Recordatorios
        </a>
        <a href="expediente.html" class="menu-item">
          <i class="fas fa-file-medical"></i>
          Expedientes
        </a>
        <a href="inventario.html" class="menu-item">
          <i class="fas fa-boxes"></i>
          Inventario
        </a>
        <a href="facturacion.html" class="menu-item">
          <i class="fas fa-file-invoice-dollar"></i>
          Facturación
        </a>
        <a href="estadisticas.html" class="menu-item active">
          <i class="fas fa-chart-bar"></i>
          Estadísticas
        </a>
        <a href="fotos.html" class="menu-item">
          <i class="fas fa-images"></i>
          Fotos
        </a>
        <a href="exportar.html" class="menu-item">
          <i class="fas fa-file-export"></i>
          Exportar
        </a>
        <a href="fidelizacion.html" class="menu-item">
          <i class="fas fa-award"></i>
          Fidelización
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-ellipsis-h"></i>
          Otros
        </div>
        <a href="bano.html" class="menu-item">
          <i class="fas fa-shower"></i>
          Baño
        </a>
        <a href="hospedaje.html" class="menu-item">
          <i class="fas fa-hotel"></i>
          Hospedaje
        </a>
      </div>

      <a href="login.html" class="menu-item">
        <i class="fas fa-sign-out-alt"></i>
        Cerrar sesión
      </a>
    </div>

    <div class="main-content">
      <h2 class="page-title">
        <i class="fas fa-chart-bar"></i>
        Estadísticas y Reportes
      </h2>

      <div class="period-selector">
        <strong>Período:</strong>
        <button class="period-btn" data-period="week">Semana</button>
        <button class="period-btn active" data-period="month">Mes</button>
        <button class="period-btn" data-period="year">Año</button>
        <button class="period-btn" data-period="all">Todo</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-paw"></i>
            </div>
          </div>
          <div class="stat-value" id="total-patients">0</div>
          <div class="stat-label">Pacientes Registrados</div>
          <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i>
            <span id="patients-trend">+12%</span> vs período anterior
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-stethoscope"></i>
            </div>
          </div>
          <div class="stat-value" id="total-consultations">0</div>
          <div class="stat-label">Consultas Realizadas</div>
          <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i>
            <span id="consultations-trend">+8%</span> vs período anterior
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
          </div>
          <div class="stat-value" id="total-revenue">$0</div>
          <div class="stat-label">Ingresos del Período</div>
          <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i>
            <span id="revenue-trend">+15%</span> vs período anterior
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
          </div>
          <div class="stat-value" id="total-appointments">0</div>
          <div class="stat-label">Citas Agendadas</div>
          <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i>
            <span id="appointments-trend">+5%</span> vs período anterior
          </div>
        </div>
      </div>

      <div class="charts-section">
        <div class="chart-container">
          <h3 class="chart-title">
            <i class="fas fa-chart-line"></i>
            Ingresos Mensuales
          </h3>
          <canvas id="revenue-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3 class="chart-title">
            <i class="fas fa-chart-pie"></i>
            Distribución de Servicios
          </h3>
          <canvas id="services-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3 class="chart-title">
            <i class="fas fa-chart-bar"></i>
            Consultas por Mes
          </h3>
          <canvas id="consultations-chart"></canvas>
        </div>

        <div class="chart-container">
          <h3 class="chart-title">
            <i class="fas fa-paw"></i>
            Tipos de Mascotas
          </h3>
          <canvas id="species-chart"></canvas>
        </div>
      </div>

      <div class="tables-section">
        <div class="data-table">
          <h3><i class="fas fa-trophy"></i> Top 10 Clientes</h3>
          <table id="top-clients-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Cliente</th>
                <th>Visitas</th>
                <th>Gasto Total</th>
              </tr>
            </thead>
            <tbody>
              <!-- Datos se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>

        <div class="data-table">
          <h3><i class="fas fa-star"></i> Servicios Más Solicitados</h3>
          <table id="top-services-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Servicio</th>
                <th>Cantidad</th>
                <th>Ingresos</th>
              </tr>
            </thead>
            <tbody>
              <!-- Datos se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Verificar sesión
    window.onload = function() {
      if(!localStorage.getItem('petCareSessionActive') || localStorage.getItem('petCareSessionActive') !== 'true') {
        window.location.href = 'login.html';
      } else {
        loadStatistics('month');
      }
    };

    // Botones de período
    document.querySelectorAll('.period-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const period = this.getAttribute('data-period');
        loadStatistics(period);
      });
    });

    let revenueChart, servicesChart, consultationsChart, speciesChart;

    function loadStatistics(period) {
      // Obtener datos
      const invoices = JSON.parse(localStorage.getItem('petCareInvoices')) || [];
      const appointments = JSON.parse(localStorage.getItem('petCareAppointments')) || [];
      const pets = JSON.parse(localStorage.getItem('petCarePets')) || [];
      
      // Filtrar por período
      const filteredInvoices = filterByPeriod(invoices, period);
      const filteredAppointments = filterByPeriod(appointments, period);
      
      // Calcular estadísticas
      updateStatCards(filteredInvoices, filteredAppointments, pets);
      
      // Generar gráficas
      generateCharts(invoices, appointments, pets);
      
      // Generar tablas
      generateTables(invoices);
    }

    function filterByPeriod(data, period) {
      const today = new Date();
      
      return data.filter(item => {
        const itemDate = new Date(item.date);
        
        switch (period) {
          case 'week':
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            return itemDate >= weekAgo;
          case 'month':
            return itemDate.getMonth() === today.getMonth() &&
                   itemDate.getFullYear() === today.getFullYear();
          case 'year':
            return itemDate.getFullYear() === today.getFullYear();
          case 'all':
          default:
            return true;
        }
      });
    }

    function updateStatCards(invoices, appointments, pets) {
      // Total pacientes
      document.getElementById('total-patients').textContent = pets.length || 3;
      
      // Total consultas (aproximado desde facturas)
      const consultations = invoices.filter(inv => 
        inv.items.some(item => item.description.toLowerCase().includes('consulta'))
      ).length;
      document.getElementById('total-consultations').textContent = consultations || 15;
      
      // Ingresos totales
      const totalRevenue = invoices
        .filter(inv => inv.status === 'pagada')
        .reduce((sum, inv) => sum + inv.total, 0);
      document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
      
      // Citas agendadas
      document.getElementById('total-appointments').textContent = appointments.length || 6;
    }

    function generateCharts(invoices, appointments, pets) {
      // Gráfica de ingresos mensuales
      if (revenueChart) revenueChart.destroy();
      
      const ctx1 = document.getElementById('revenue-chart').getContext('2d');
      const monthlyRevenue = calculateMonthlyRevenue(invoices);
      
      revenueChart = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
          datasets: [{
            label: 'Ingresos ($)',
            data: monthlyRevenue,
            borderColor: '#008080',
            backgroundColor: 'rgba(0, 128, 128, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Gráfica de distribución de servicios
      if (servicesChart) servicesChart.destroy();
      
      const ctx2 = document.getElementById('services-chart').getContext('2d');
      const servicesDist = calculateServicesDistribution(invoices);
      
      servicesChart = new Chart(ctx2, {
        type: 'doughnut',
        data: {
          labels: servicesDist.labels,
          datasets: [{
            data: servicesDist.data,
            backgroundColor: [
              '#008080',
              '#00a3a3',
              '#4CAF50',
              '#2196F3',
              '#ff9800',
              '#9C27B0'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Gráfica de consultas por mes
      if (consultationsChart) consultationsChart.destroy();
      
      const ctx3 = document.getElementById('consultations-chart').getContext('2d');
      const monthlyConsultations = calculateMonthlyConsultations(invoices);
      
      consultationsChart = new Chart(ctx3, {
        type: 'bar',
        data: {
          labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
          datasets: [{
            label: 'Consultas',
            data: monthlyConsultations,
            backgroundColor: '#008080'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });

      // Gráfica de tipos de mascotas
      if (speciesChart) speciesChart.destroy();
      
      const ctx4 = document.getElementById('species-chart').getContext('2d');
      const speciesDist = calculateSpeciesDistribution(pets);
      
      speciesChart = new Chart(ctx4, {
        type: 'pie',
        data: {
          labels: speciesDist.labels,
          datasets: [{
            data: speciesDist.data,
            backgroundColor: [
              '#008080',
              '#ff9800',
              '#4CAF50',
              '#2196F3'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function calculateMonthlyRevenue(invoices) {
      const monthly = new Array(12).fill(0);
      const currentYear = new Date().getFullYear();
      
      invoices.forEach(inv => {
        if (inv.status === 'pagada') {
          const invDate = new Date(inv.date);
          if (invDate.getFullYear() === currentYear) {
            monthly[invDate.getMonth()] += inv.total;
          }
        }
      });
      
      // Si no hay datos, usar datos de ejemplo
      if (monthly.every(val => val === 0)) {
        const currentMonth = new Date().getMonth();
        return monthly.map((val, idx) => {
          if (idx <= currentMonth) {
            return Math.random() * 5000 + 2000;
          }
          return 0;
        });
      }
      
      return monthly;
    }

    function calculateServicesDistribution(invoices) {
      const services = {};
      
      invoices.forEach(inv => {
        inv.items.forEach(item => {
          const service = item.description;
          services[service] = (services[service] || 0) + 1;
        });
      });
      
      // Si no hay datos, usar datos de ejemplo
      if (Object.keys(services).length === 0) {
        return {
          labels: ['Consultas', 'Baños', 'Vacunas', 'Cirugías', 'Hospedaje', 'Otros'],
          data: [35, 25, 20, 10, 7, 3]
        };
      }
      
      const sorted = Object.entries(services).sort((a, b) => b[1] - a[1]).slice(0, 6);
      
      return {
        labels: sorted.map(s => s[0]),
        data: sorted.map(s => s[1])
      };
    }

    function calculateMonthlyConsultations(invoices) {
      const monthly = new Array(12).fill(0);
      const currentYear = new Date().getFullYear();
      
      invoices.forEach(inv => {
        const invDate = new Date(inv.date);
        if (invDate.getFullYear() === currentYear) {
          if (inv.items.some(item => item.description.toLowerCase().includes('consulta'))) {
            monthly[invDate.getMonth()]++;
          }
        }
      });
      
      // Si no hay datos, usar datos de ejemplo
      if (monthly.every(val => val === 0)) {
        const currentMonth = new Date().getMonth();
        return monthly.map((val, idx) => {
          if (idx <= currentMonth) {
            return Math.floor(Math.random() * 15) + 5;
          }
          return 0;
        });
      }
      
      return monthly;
    }

    function calculateSpeciesDistribution(pets) {
      const species = {};
      
      pets.forEach(pet => {
        species[pet.species] = (species[pet.species] || 0) + 1;
      });
      
      // Si no hay datos, usar datos de ejemplo
      if (Object.keys(species).length === 0) {
        return {
          labels: ['Perros', 'Gatos', 'Aves', 'Otros'],
          data: [55, 35, 7, 3]
        };
      }
      
      return {
        labels: Object.keys(species),
        data: Object.values(species)
      };
    }

    function generateTables(invoices) {
      // Top clientes
      const clientsData = {};
      
      invoices.forEach(inv => {
        if (!clientsData[inv.clientName]) {
          clientsData[inv.clientName] = {
            visits: 0,
            total: 0
          };
        }
        clientsData[inv.clientName].visits++;
        if (inv.status === 'pagada') {
          clientsData[inv.clientName].total += inv.total;
        }
      });
      
      const topClients = Object.entries(clientsData)
        .sort((a, b) => b[1].total - a[1].total)
        .slice(0, 10);
      
      const clientsTable = document.getElementById('top-clients-table').querySelector('tbody');
      clientsTable.innerHTML = '';
      
      if (topClients.length === 0) {
        // Datos de ejemplo
        const exampleClients = [
          { name: 'Juan Pérez', visits: 8, total: 5420.00 },
          { name: 'María García', visits: 6, total: 4280.00 },
          { name: 'Carlos Rodríguez', visits: 5, total: 3950.00 },
          { name: 'Ana Martínez', visits: 4, total: 2840.00 },
          { name: 'Luis Fernández', visits: 3, total: 2320.00 }
        ];
        
        exampleClients.forEach((client, idx) => {
          const row = document.createElement('tr');
          const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
          
          row.innerHTML = `
            <td><span class="ranking-position ${rankClass}">${idx + 1}</span></td>
            <td>${client.name}</td>
            <td>${client.visits}</td>
            <td>$${client.total.toFixed(2)}</td>
          `;
          clientsTable.appendChild(row);
        });
      } else {
        topClients.forEach(([name, data], idx) => {
          const row = document.createElement('tr');
          const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
          
          row.innerHTML = `
            <td><span class="ranking-position ${rankClass}">${idx + 1}</span></td>
            <td>${name}</td>
            <td>${data.visits}</td>
            <td>$${data.total.toFixed(2)}</td>
          `;
          clientsTable.appendChild(row);
        });
      }
      
      // Top servicios
      const servicesData = {};
      
      invoices.forEach(inv => {
        inv.items.forEach(item => {
          if (!servicesData[item.description]) {
            servicesData[item.description] = {
              count: 0,
              revenue: 0
            };
          }
          servicesData[item.description].count += item.quantity;
          servicesData[item.description].revenue += item.quantity * item.price;
        });
      });
      
      const topServices = Object.entries(servicesData)
        .sort((a, b) => b[1].revenue - a[1].revenue)
        .slice(0, 10);
      
      const servicesTable = document.getElementById('top-services-table').querySelector('tbody');
      servicesTable.innerHTML = '';
      
      if (topServices.length === 0) {
        // Datos de ejemplo
        const exampleServices = [
          { name: 'Consulta General', count: 42, revenue: 14700.00 },
          { name: 'Vacuna Antirrábica', count: 38, revenue: 9500.00 },
          { name: 'Baño Completo', count: 35, revenue: 14000.00 },
          { name: 'Limpieza Dental', count: 12, revenue: 14400.00 },
          { name: 'Cirugía Menor', count: 8, revenue: 20000.00 }
        ];
        
        exampleServices.forEach((service, idx) => {
          const row = document.createElement('tr');
          const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
          
          row.innerHTML = `
            <td><span class="ranking-position ${rankClass}">${idx + 1}</span></td>
            <td>${service.name}</td>
            <td>${service.count}</td>
            <td>$${service.revenue.toFixed(2)}</td>
          `;
          servicesTable.appendChild(row);
        });
      } else {
        topServices.forEach(([name, data], idx) => {
          const row = document.createElement('tr');
          const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
          
          row.innerHTML = `
            <td><span class="ranking-position ${rankClass}">${idx + 1}</span></td>
            <td>${name}</td>
            <td>${data.count}</td>
            <td>$${data.revenue.toFixed(2)}</td>
          `;
          servicesTable.appendChild(row);
        });
      }
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pet Care - Programa de Fidelizaci√≥n</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #008080, #00a3a3);
      min-height: 100vh;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .header {
      background: #006666;
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      animation: slideDown 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideDown {
      0% { transform: translateY(-100%); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    .header h1 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      font-size: 28px;
    }

    .header .info {
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.9;
    }

    .container {
      display: flex;
      min-height: calc(100vh - 120px);
    }

    @keyframes slideInLeft {
      0% { transform: translateX(-50px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideInRight {
      0% { transform: translateX(50px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    .sidebar {
      width: 250px;
      background: #004d4d;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .menu-section {
      margin-bottom: 30px;
    }

    .menu-title {
      color: white;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 20px;
      color: #b3d9d9;
      text-decoration: none;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 4px solid transparent;
      will-change: transform;
    }

    .menu-item:hover, .menu-item.active {
      background: #006666;
      color: white;
      border-left-color: #00e6e6;
    }

    .main-content {
      flex-grow: 1;
      padding: 30px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      margin: 20px;
      animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      overflow: auto;
    }

    .page-title {
      color: #006666;
      margin-bottom: 20px;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .loyalty-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .search-bar {
      display: flex;
      gap: 10px;
      flex-grow: 1;
      max-width: 500px;
    }

    .search-input {
      flex-grow: 1;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 14px;
    }

    .action-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .btn-primary {
      background: #008080;
      color: white;
    }

    .btn-primary:hover {
      background: #006666;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .stat-card:nth-child(1) .stat-icon {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: white;
    }

    .stat-card:nth-child(2) .stat-icon {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
    }

    .stat-card:nth-child(3) .stat-icon {
      background: linear-gradient(135deg, #2196F3, #1565C0);
      color: white;
    }

    .stat-card:nth-child(4) .stat-icon {
      background: linear-gradient(135deg, #9C27B0, #6A1B9A);
      color: white;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
    }

    .loyalty-tiers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .tier-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      border-top: 5px solid;
      position: relative;
      overflow: hidden;
    }

    .tier-card.bronce {
      border-top-color: #CD7F32;
    }

    .tier-card.plata {
      border-top-color: #C0C0C0;
    }

    .tier-card.oro {
      border-top-color: #FFD700;
    }

    .tier-card.diamante {
      border-top-color: #B9F2FF;
    }

    .tier-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 40px;
      opacity: 0.2;
    }

    .tier-name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }

    .tier-requirements {
      font-size: 14px;
      color: #666;
      margin-bottom: 15px;
    }

    .tier-benefits {
      list-style: none;
      padding: 0;
    }

    .tier-benefits li {
      padding: 8px 0;
      font-size: 13px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tier-benefits li i {
      color: #4CAF50;
      font-size: 16px;
    }

    .tier-members {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      font-size: 14px;
      color: #666;
      text-align: center;
    }

    .members-table {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .table-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      padding: 8px 15px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .filter-btn.active {
      background: #008080;
      color: white;
      border-color: #008080;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f5f5f5;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: bold;
      color: #333;
      font-size: 14px;
      border-bottom: 2px solid #e0e0e0;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
      color: #333;
    }

    tbody tr {
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background: #f9f9f9;
    }

    .tier-badge-table {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: bold;
      color: white;
    }

    .badge-bronce {
      background: #CD7F32;
    }

    .badge-plata {
      background: #C0C0C0;
      color: #333;
    }

    .badge-oro {
      background: #FFD700;
      color: #333;
    }

    .badge-diamante {
      background: linear-gradient(135deg, #B9F2FF, #4FC3F7);
      color: #333;
    }

    .points-display {
      font-weight: bold;
      color: #008080;
    }

    .action-icons {
      display: flex;
      gap: 10px;
    }

    .icon-btn {
      background: none;
      border: none;
      font-size: 16px;
      color: #666;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 5px;
    }

    .icon-btn:hover {
      color: #008080;
      transform: scale(1.2);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      overflow-y: auto;
    }

    .modal-content {
      background-color: white;
      margin: 3% auto;
      padding: 0;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      animation: slideDown 0.3s ease-out;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px;
      border-bottom: 1px solid #e0e0e0;
    }

    .modal-title {
      color: #006666;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
    }

    .close:hover {
      color: #555;
    }

    .modal-body {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .form-control {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      border-color: #008080;
      outline: none;
    }

    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .member-detail {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: bold;
      color: #666;
    }

    .detail-value {
      color: #333;
    }

    .transaction-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: white;
      border: 1px solid #e0e0e0;
    }

    .transaction-info {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .transaction-date {
      font-size: 12px;
      color: #999;
    }

    .transaction-description {
      font-size: 14px;
      color: #333;
    }

    .transaction-points {
      font-size: 16px;
      font-weight: bold;
    }

    .points-positive {
      color: #4CAF50;
    }

    .points-negative {
      color: #f44336;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .empty-icon {
      font-size: 60px;
      color: #ddd;
      margin-bottom: 15px;
    }

    .tier-icon-bronce {
      color: #CD7F32;
    }

    .tier-icon-plata {
      color: #C0C0C0;
    }

    .tier-icon-oro {
      color: #FFD700;
    }

    .tier-icon-diamante {
      color: #B9F2FF;
    }

    .history-title {
      margin-bottom: 15px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>
      <i class="fas fa-paw"></i>
      Pet Care - Sistema Veterinario
    </h1>
    <div class="info">
      Calzada del Tecnol√≥gico S/N, Unidad Tomas Aquino
      <br>
      C.P. 22414, Tijuana, Baja California
      <br>
      664-623-4054
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-home"></i>
          Inicio
        </div>
        <a href="inicio.html" class="menu-item">
          <i class="fas fa-chart-line"></i>
          Dashboard
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-users"></i>
          Pacientes
        </div>
        <a href="registro.html" class="menu-item">
          <i class="fas fa-user-plus"></i>
          Registrar
        </a>
        <a href="buscar_mascota.html" class="menu-item">
          <i class="fas fa-search"></i>
          Buscar
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-stethoscope"></i>
          Consulta
        </div>
        <a href="consulta.html" class="menu-item">
          <i class="fas fa-user-plus"></i>
          Registrar
        </a>
        <a href="buscar_consulta.html" class="menu-item">
          <i class="fas fa-search"></i>
          Buscar
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-calendar-alt"></i>
          Gesti√≥n
        </div>
        <a href="calendario.html" class="menu-item">
          <i class="fas fa-calendar-check"></i>
          Calendario
        </a>
        <a href="recordatorios.html" class="menu-item">
          <i class="fas fa-bell"></i>
          Recordatorios
        </a>
        <a href="expediente.html" class="menu-item">
          <i class="fas fa-file-medical"></i>
          Expedientes
        </a>
        <a href="inventario.html" class="menu-item">
          <i class="fas fa-boxes"></i>
          Inventario
        </a>
        <a href="facturacion.html" class="menu-item">
          <i class="fas fa-file-invoice-dollar"></i>
          Facturaci√≥n
        </a>
        <a href="estadisticas.html" class="menu-item">
          <i class="fas fa-chart-bar"></i>
          Estad√≠sticas
        </a>
        <a href="fotos.html" class="menu-item">
          <i class="fas fa-images"></i>
          Fotos
        </a>
        <a href="exportar.html" class="menu-item">
          <i class="fas fa-file-export"></i>
          Exportar
        </a>
        <a href="fidelizacion.html" class="menu-item active">
          <i class="fas fa-award"></i>
          Fidelizaci√≥n
        </a>
      </div>

      <div class="menu-section">
        <div class="menu-title">
          <i class="fas fa-ellipsis-h"></i>
          Otros
        </div>
        <a href="bano.html" class="menu-item">
          <i class="fas fa-shower"></i>
          Ba√±o
        </a>
        <a href="hospedaje.html" class="menu-item">
          <i class="fas fa-hotel"></i>
          Hospedaje
        </a>
      </div>

      <a href="login.html" class="menu-item">
        <i class="fas fa-sign-out-alt"></i>
        Cerrar sesi√≥n
      </a>
    </div>

    <div class="main-content">
      <h2 class="page-title">
        <i class="fas fa-award"></i>
        Programa de Fidelizaci√≥n
      </h2>

      <div class="loyalty-header">
        <div class="search-bar">
          <input type="text" class="search-input" id="search-member" placeholder="Buscar cliente...">
        </div>
        <button class="action-btn btn-primary" id="add-points-btn">
          <i class="fas fa-plus-circle"></i> Agregar Puntos
        </button>
      </div>

      <!-- Estad√≠sticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-value" id="total-members">0</div>
          <div class="stat-label">Miembros Activos</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="stat-value" id="total-points">0</div>
          <div class="stat-label">Puntos Activos</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-gift"></i>
          </div>
          <div class="stat-value" id="redeemed-rewards">0</div>
          <div class="stat-label">Recompensas Canjeadas</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="stat-value" id="top-tier-members">0</div>
          <div class="stat-label">Miembros Oro/Diamante</div>
        </div>
      </div>

      <!-- Niveles de Fidelizaci√≥n -->
      <div class="loyalty-tiers">
        <div class="tier-card bronce">
          <i class="fas fa-medal tier-badge"></i>
          <div class="tier-name">
            <i class="fas fa-medal tier-icon-bronce"></i> Bronce
          </div>
          <div class="tier-requirements">0 - 499 puntos</div>
          <ul class="tier-benefits">
            <li><i class="fas fa-check"></i> 5% descuento en consultas</li>
            <li><i class="fas fa-check"></i> Recordatorios de vacunas</li>
            <li><i class="fas fa-check"></i> Newsletter mensual</li>
          </ul>
          <div class="tier-members" id="bronce-members">0 miembros</div>
        </div>

        <div class="tier-card plata">
          <i class="fas fa-medal tier-badge"></i>
          <div class="tier-name">
            <i class="fas fa-medal tier-icon-plata"></i> Plata
          </div>
          <div class="tier-requirements">500 - 1,499 puntos</div>
          <ul class="tier-benefits">
            <li><i class="fas fa-check"></i> 10% descuento en consultas</li>
            <li><i class="fas fa-check"></i> 5% descuento en productos</li>
            <li><i class="fas fa-check"></i> Prioridad en citas</li>
            <li><i class="fas fa-check"></i> 1 ba√±o gratis al a√±o</li>
          </ul>
          <div class="tier-members" id="plata-members">0 miembros</div>
        </div>

        <div class="tier-card oro">
          <i class="fas fa-crown tier-badge"></i>
          <div class="tier-name">
            <i class="fas fa-crown tier-icon-oro"></i> Oro
          </div>
          <div class="tier-requirements">1,500 - 2,999 puntos</div>
          <ul class="tier-benefits">
            <li><i class="fas fa-check"></i> 15% descuento en consultas</li>
            <li><i class="fas fa-check"></i> 10% descuento en productos</li>
            <li><i class="fas fa-check"></i> 2 ba√±os gratis al a√±o</li>
            <li><i class="fas fa-check"></i> Consulta preventiva gratis</li>
            <li><i class="fas fa-check"></i> Atenci√≥n preferencial</li>
          </ul>
          <div class="tier-members" id="oro-members">0 miembros</div>
        </div>

        <div class="tier-card diamante">
          <i class="fas fa-gem tier-badge"></i>
          <div class="tier-name">
            <i class="fas fa-gem tier-icon-diamante"></i> Diamante
          </div>
          <div class="tier-requirements">3,000+ puntos</div>
          <ul class="tier-benefits">
            <li><i class="fas fa-check"></i> 20% descuento en todo</li>
            <li><i class="fas fa-check"></i> 4 ba√±os gratis al a√±o</li>
            <li><i class="fas fa-check"></i> 2 consultas gratis al a√±o</li>
            <li><i class="fas fa-check"></i> Servicio a domicilio</li>
            <li><i class="fas fa-check"></i> Hospedaje con descuento</li>
          </ul>
          <div class="tier-members" id="diamante-members">0 miembros</div>
        </div>
      </div>

      <!-- Tabla de miembros -->
      <div class="members-table">
        <div class="table-header">
          <div class="table-title">
            <i class="fas fa-users"></i>
            Miembros del Programa
          </div>
          <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">Todos</button>
            <button class="filter-btn" data-filter="bronce">Bronce</button>
            <button class="filter-btn" data-filter="plata">Plata</button>
            <button class="filter-btn" data-filter="oro">Oro</button>
            <button class="filter-btn" data-filter="diamante">Diamante</button>
          </div>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Nivel</th>
              <th>Puntos</th>
              <th>Visitas</th>
              <th>√öltimo Movimiento</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="members-table-body">
            <!-- Se llenar√° din√°micamente -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal agregar puntos -->
  <div id="points-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-coins"></i>
          Gestionar Puntos
        </h3>
        <button class="close" id="close-points-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="points-form">
          <div class="form-group">
            <label for="member-name">Cliente</label>
            <input type="text" id="member-name" class="form-control" required placeholder="Nombre del cliente">
          </div>

          <div class="form-group">
            <label for="points-action">Acci√≥n</label>
            <select id="points-action" class="form-control" required>
              <option value="add">Agregar Puntos</option>
              <option value="redeem">Canjear Puntos</option>
            </select>
          </div>

          <div class="form-group">
            <label for="points-amount">Cantidad de Puntos</label>
            <input type="number" id="points-amount" class="form-control" required min="1" placeholder="Ej: 100">
          </div>

          <div class="form-group">
            <label for="points-reason">Motivo</label>
            <select id="points-reason" class="form-control" required>
              <option value="">Seleccionar...</option>
              <option value="consulta">Consulta</option>
              <option value="compra">Compra de productos</option>
              <option value="cirugia">Cirug√≠a</option>
              <option value="bano">Servicio de ba√±o</option>
              <option value="hospedaje">Hospedaje</option>
              <option value="referido">Cliente referido</option>
              <option value="cumplea√±os">Puntos de cumplea√±os</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="points-notes">Notas</label>
            <textarea id="points-notes" class="form-control" rows="3" placeholder="Detalles adicionales..."></textarea>
          </div>

          <div class="button-group">
            <button type="button" class="action-btn btn-primary" id="cancel-points">Cancelar</button>
            <button type="submit" class="action-btn btn-primary">
              <i class="fas fa-save"></i> Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal ver detalle -->
  <div id="detail-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-user"></i>
          <span id="detail-member-name">Detalle del Cliente</span>
        </h3>
        <button class="close" id="close-detail-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="member-detail" id="member-detail-content">
          <!-- Se llenar√° din√°micamente -->
        </div>
        
        <h4 class="history-title">
          <i class="fas fa-history"></i> Historial de Puntos
        </h4>
        <div class="transaction-list" id="transaction-list">
          <!-- Se llenar√° din√°micamente -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Verificar sesi√≥n
    window.onload = function() {
      if(!localStorage.getItem('petCareSessionActive') || localStorage.getItem('petCareSessionActive') !== 'true') {
        window.location.href = 'login.html';
      } else {
        loadLoyaltyData();
      }
    };

    // Cargar datos de fidelizaci√≥n
    function loadLoyaltyData() {
      let members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
      
      // Datos de ejemplo si no hay miembros
      if (members.length === 0) {
        const today = new Date();
        
        members = [
          {
            id: 'LM001',
            name: 'Carlos Ram√≠rez',
            points: 2850,
            visits: 28,
            tier: 'oro',
            joinDate: '2024-01-15',
            lastActivity: today.toISOString().split('T')[0],
            transactions: [
              { date: today.toISOString().split('T')[0], description: 'Consulta veterinaria', points: 50, type: 'add' },
              { date: '2024-09-20', description: 'Compra de alimento', points: 150, type: 'add' },
              { date: '2024-08-10', description: 'Canje: Ba√±o gratis', points: -200, type: 'redeem' }
            ]
          },
          {
            id: 'LM002',
            name: 'Ana Mart√≠nez',
            points: 3500,
            visits: 35,
            tier: 'diamante',
            joinDate: '2023-11-20',
            lastActivity: new Date(today.getTime() - 3*24*60*60*1000).toISOString().split('T')[0],
            transactions: [
              { date: new Date(today.getTime() - 3*24*60*60*1000).toISOString().split('T')[0], description: 'Cirug√≠a menor', points: 300, type: 'add' },
              { date: '2024-08-25', description: 'Hospedaje 3 d√≠as', points: 250, type: 'add' }
            ]
          },
          {
            id: 'LM003',
            name: 'Luis Garc√≠a',
            points: 1200,
            visits: 15,
            tier: 'plata',
            joinDate: '2024-03-10',
            lastActivity: new Date(today.getTime() - 7*24*60*60*1000).toISOString().split('T')[0],
            transactions: [
              { date: new Date(today.getTime() - 7*24*60*60*1000).toISOString().split('T')[0], description: 'Vacunaci√≥n m√∫ltiple', points: 100, type: 'add' },
              { date: '2024-07-15', description: 'Compra de medicamentos', points: 80, type: 'add' }
            ]
          },
          {
            id: 'LM004',
            name: 'Mar√≠a L√≥pez',
            points: 450,
            visits: 8,
            tier: 'bronce',
            joinDate: '2024-06-01',
            lastActivity: new Date(today.getTime() - 14*24*60*60*1000).toISOString().split('T')[0],
            transactions: [
              { date: new Date(today.getTime() - 14*24*60*60*1000).toISOString().split('T')[0], description: 'Primera consulta', points: 50, type: 'add' },
              { date: '2024-08-01', description: 'Ba√±o y corte', points: 75, type: 'add' }
            ]
          },
          {
            id: 'LM005',
            name: 'Roberto S√°nchez',
            points: 850,
            visits: 12,
            tier: 'plata',
            joinDate: '2024-02-20',
            lastActivity: new Date(today.getTime() - 5*24*60*60*1000).toISOString().split('T')[0],
            transactions: [
              { date: new Date(today.getTime() - 5*24*60*60*1000).toISOString().split('T')[0], description: 'Consulta de seguimiento', points: 50, type: 'add' },
              { date: '2024-09-01', description: 'Cliente referido', points: 200, type: 'add' }
            ]
          }
        ];
        
        localStorage.setItem('petCareLoyaltyMembers', JSON.stringify(members));
      }
      
      updateStatistics(members);
      updateTierCounts(members);
      renderMembersTable(members);
    }

    // Actualizar estad√≠sticas
    function updateStatistics(members) {
      document.getElementById('total-members').textContent = members.length;
      
      const totalPoints = members.reduce((sum, m) => sum + m.points, 0);
      document.getElementById('total-points').textContent = totalPoints.toLocaleString();
      
      let totalRedeemed = 0;
      members.forEach(m => {
        m.transactions.forEach(t => {
          if (t.type === 'redeem') {
            totalRedeemed++;
          }
        });
      });
      document.getElementById('redeemed-rewards').textContent = totalRedeemed;
      
      const topTierMembers = members.filter(m => m.tier === 'oro' || m.tier === 'diamante').length;
      document.getElementById('top-tier-members').textContent = topTierMembers;
    }

    // Actualizar contadores de niveles
    function updateTierCounts(members) {
      const bronceCount = members.filter(m => m.tier === 'bronce').length;
      const plataCount = members.filter(m => m.tier === 'plata').length;
      const oroCount = members.filter(m => m.tier === 'oro').length;
      const diamanteCount = members.filter(m => m.tier === 'diamante').length;
      
      document.getElementById('bronce-members').textContent = bronceCount + ' miembros';
      document.getElementById('plata-members').textContent = plataCount + ' miembros';
      document.getElementById('oro-members').textContent = oroCount + ' miembros';
      document.getElementById('diamante-members').textContent = diamanteCount + ' miembros';
    }

    // Renderizar tabla de miembros
    function renderMembersTable(members, filter = 'all') {
      const tbody = document.getElementById('members-table-body');
      tbody.innerHTML = '';
      
      let filteredMembers = members;
      if (filter !== 'all') {
        filteredMembers = members.filter(m => m.tier === filter);
      }
      
      filteredMembers.sort((a, b) => b.points - a.points);
      
      filteredMembers.forEach(member => {
        const row = document.createElement('tr');
        
        const lastActivityDate = new Date(member.lastActivity).toLocaleDateString('es-MX');
        
        row.innerHTML = `
          <td>${member.name}</td>
          <td><span class="tier-badge-table badge-${member.tier}">${getTierName(member.tier)}</span></td>
          <td><span class="points-display">${member.points.toLocaleString()}</span></td>
          <td>${member.visits}</td>
          <td>${lastActivityDate}</td>
          <td class="action-icons">
            <button class="icon-btn view-detail" data-id="${member.id}" title="Ver detalle">
              <i class="fas fa-eye"></i>
            </button>
            <button class="icon-btn add-points" data-id="${member.id}" title="Agregar puntos">
              <i class="fas fa-plus-circle"></i>
            </button>
            <button class="icon-btn delete-member" data-id="${member.id}" title="Eliminar">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      addTableEventListeners();
    }

    function getTierName(tier) {
      const names = {
        'bronce': 'Bronce',
        'plata': 'Plata',
        'oro': 'Oro',
        'diamante': 'Diamante'
      };
      return names[tier] || tier;
    }

    // Calcular nivel seg√∫n puntos
    function calculateTier(points) {
      if (points >= 3000) return 'diamante';
      if (points >= 1500) return 'oro';
      if (points >= 500) return 'plata';
      return 'bronce';
    }

    // Event listeners de tabla
    function addTableEventListeners() {
      document.querySelectorAll('.view-detail').forEach(btn => {
        btn.addEventListener('click', function() {
          viewMemberDetail(this.getAttribute('data-id'));
        });
      });
      
      document.querySelectorAll('.add-points').forEach(btn => {
        btn.addEventListener('click', function() {
          const members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
          const member = members.find(m => m.id === this.getAttribute('data-id'));
          if (member) {
            document.getElementById('member-name').value = member.name;
            pointsModal.style.display = 'block';
          }
        });
      });
      
      document.querySelectorAll('.delete-member').forEach(btn => {
        btn.addEventListener('click', function() {
          deleteMember(this.getAttribute('data-id'));
        });
      });
    }

    // Ver detalle de miembro
    function viewMemberDetail(memberId) {
      const members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
      const member = members.find(m => m.id === memberId);
      
      if (!member) return;
      
      document.getElementById('detail-member-name').textContent = member.name;
      
      const joinDate = new Date(member.joinDate).toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' });
      const lastActivity = new Date(member.lastActivity).toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' });
      
      let nextTier = '';
      let pointsToNext = 0;
      if (member.tier === 'bronce') {
        nextTier = 'Plata';
        pointsToNext = 500 - member.points;
      } else if (member.tier === 'plata') {
        nextTier = 'Oro';
        pointsToNext = 1500 - member.points;
      } else if (member.tier === 'oro') {
        nextTier = 'Diamante';
        pointsToNext = 3000 - member.points;
      }
      
      document.getElementById('member-detail-content').innerHTML = `
        <div class="detail-row">
          <span class="detail-label">Nivel actual:</span>
          <span class="detail-value"><span class="tier-badge-table badge-${member.tier}">${getTierName(member.tier)}</span></span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Puntos actuales:</span>
          <span class="detail-value"><strong>${member.points.toLocaleString()}</strong></span>
        </div>
        ${nextTier ? `
        <div class="detail-row">
          <span class="detail-label">Puntos para ${nextTier}:</span>
          <span class="detail-value">${pointsToNext} puntos</span>
        </div>
        ` : '<div class="detail-row"><span class="detail-label">Estado:</span><span class="detail-value">¬°Nivel m√°ximo alcanzado! üéâ</span></div>'}
        <div class="detail-row">
          <span class="detail-label">Total de visitas:</span>
          <span class="detail-value">${member.visits}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Miembro desde:</span>
          <span class="detail-value">${joinDate}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">√öltima actividad:</span>
          <span class="detail-value">${lastActivity}</span>
        </div>
      `;
      
      const transactionList = document.getElementById('transaction-list');
      transactionList.innerHTML = '';
      
      if (member.transactions && member.transactions.length > 0) {
        member.transactions.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(transaction => {
          const transDate = new Date(transaction.date).toLocaleDateString('es-MX');
          const item = document.createElement('div');
          item.className = 'transaction-item';
          
          item.innerHTML = `
            <div class="transaction-info">
              <div class="transaction-date">${transDate}</div>
              <div class="transaction-description">${transaction.description}</div>
            </div>
            <div class="transaction-points ${transaction.type === 'add' ? 'points-positive' : 'points-negative'}">
              ${transaction.type === 'add' ? '+' : '-'}${Math.abs(transaction.points)}
            </div>
          `;
          
          transactionList.appendChild(item);
        });
      } else {
        transactionList.innerHTML = '<div class="empty-state"><div class="empty-icon"><i class="fas fa-history"></i></div><div>Sin transacciones</div></div>';
      }
      
      document.getElementById('detail-modal').style.display = 'block';
    }

    // Eliminar miembro
    function deleteMember(memberId) {
      if (confirm('¬øEst√° seguro de que desea eliminar este miembro del programa?')) {
        let members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
        members = members.filter(m => m.id !== memberId);
        localStorage.setItem('petCareLoyaltyMembers', JSON.stringify(members));
        loadLoyaltyData();
      }
    }

    // Modales
    const pointsModal = document.getElementById('points-modal');
    const addPointsBtn = document.getElementById('add-points-btn');
    const closePointsModal = document.getElementById('close-points-modal');
    const cancelPoints = document.getElementById('cancel-points');

    addPointsBtn.addEventListener('click', () => {
      document.getElementById('points-form').reset();
      pointsModal.style.display = 'block';
    });

    closePointsModal.addEventListener('click', () => {
      pointsModal.style.display = 'none';
    });

    cancelPoints.addEventListener('click', () => {
      pointsModal.style.display = 'none';
    });

    document.getElementById('close-detail-modal').addEventListener('click', () => {
      document.getElementById('detail-modal').style.display = 'none';
    });

    // Guardar puntos
    document.getElementById('points-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const memberName = document.getElementById('member-name').value;
      const action = document.getElementById('points-action').value;
      const amount = parseInt(document.getElementById('points-amount').value);
      const reason = document.getElementById('points-reason').value;
      const notes = document.getElementById('points-notes').value;
      
      let members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
      let member = members.find(m => m.name.toLowerCase() === memberName.toLowerCase());
      
      if (!member) {
        member = {
          id: 'LM' + String(members.length + 1).padStart(3, '0'),
          name: memberName,
          points: 0,
          visits: 0,
          tier: 'bronce',
          joinDate: new Date().toISOString().split('T')[0],
          lastActivity: new Date().toISOString().split('T')[0],
          transactions: []
        };
        members.push(member);
      }
      
      const pointsChange = action === 'add' ? amount : -amount;
      member.points = Math.max(0, member.points + pointsChange);
      member.tier = calculateTier(member.points);
      member.lastActivity = new Date().toISOString().split('T')[0];
      
      if (action === 'add') {
        member.visits++;
      }
      
      const reasonText = document.getElementById('points-reason').options[document.getElementById('points-reason').selectedIndex].text;
      member.transactions.push({
        date: new Date().toISOString().split('T')[0],
        description: notes || reasonText,
        points: pointsChange,
        type: action
      });
      
      localStorage.setItem('petCareLoyaltyMembers', JSON.stringify(members));
      
      pointsModal.style.display = 'none';
      loadLoyaltyData();
    });

    // Filtros
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.getAttribute('data-filter');
        const members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
        renderMembersTable(members, filter);
      });
    });

    // Buscar
    document.getElementById('search-member').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const members = JSON.parse(localStorage.getItem('petCareLoyaltyMembers')) || [];
      
      const filtered = members.filter(m => m.name.toLowerCase().includes(searchTerm));
      renderMembersTable(filtered);
    });

    // Cerrar modales al hacer clic fuera
    window.addEventListener('click', function(e) {
      if (e.target === pointsModal) pointsModal.style.display = 'none';
      if (e.target === document.getElementById('detail-modal')) {
        document.getElementById('detail-modal').style.display = 'none';
      }
    });
  </script>
</body>
</html>